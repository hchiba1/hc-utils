#!/usr/bin/perl -w
use strict;
use File::Basename;
my $PROGRAM = basename $0;
my $USAGE=
"Usage: $PROGRAM
-n: show full names
-s: --stat option
";

###         hash [date](desc)subj <mail>name
my $FORMAT = "%h%x09[%ai]%d %s%x09<%ae>";

my $CONVERT = 0;
for (my $i=0; $i<@ARGV; $i++) {
    if ($ARGV[$i] eq "-s" or $ARGV[$i] eq "-S") {
        if ($ARGV[$i] eq "-s") {
            $CONVERT = 1;
        }
        splice(@ARGV, $i, 1);
        unshift(@ARGV, "--stat");
        $FORMAT = "(%h)%x09[%ai]%d %s%x09<%ae>";
        last;
    }
}

for (my $i=0; $i<@ARGV; $i++) {
    if ($ARGV[$i] eq "-n") {
        splice(@ARGV, $i, 1);
        $FORMAT .= " %an";
        last;
    }
}

if ($CONVERT) {
    system "git log --graph --format='$FORMAT' @ARGV | convert_log.pl"
} else {
    system "git log --graph --format='$FORMAT' @ARGV"
}
